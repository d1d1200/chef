## Autogenerated using chef nginx::backend any modification here will be overidden

upstream <%= node.nginx[:beno_bename] %> {
    server <%= node.nginx[:beno_backend] rescue 'localhost' %>:<%= node.nginx[:beno_backend_port] rescue '3000' %> weight=1 fail_timeout=0;
    
    <% if @be_backend1 %>
    server <%= node.nginx[:beno_backend1] rescue 'localhost' %>:<%= node.nginx[:beno_backend1_port] rescue '8000' %> weight=1 fail_timeout=0;
    <% end -%>

}

server {
  listen   <%= node.nginx[:beno_port] %>;
  server_name   <%= node.nginx[:beno_servername] %>;
  error_log   <%= node.nginx[:beno_log_dir] %>/<%= node.nginx[:beno_bename] %>-errors.log;
  access_log  <%= node.nginx[:beno_log_dir] %>/<%= node.nginx[:beno_bename] %>-access.log;

  location <%= node.nginx[:beno_location] %> {

    # Pass requests to backend <%= node.nginx[:beno_bename] %>
    ##<!-- proxy_pass http://<%= node.nginx[:be_backend] rescue 'localhost' %>:<%= node.nginx[:be_backend_port] rescue '3000' %>; -->
    proxy_pass http://<%= node.nginx[:beno_bename] rescue 'localhost' %>;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_redirect off;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header  Host $http_host;
##  try_files $uri $uri/index.html $uri.html @<%= node.nginx[:beno_bename] %>;

    # For CORS Ajax
    proxy_pass_header Access-Control-Allow-Origin;
    proxy_pass_header Access-Control-Allow-Methods;
    proxy_hide_header Access-Control-Allow-Headers;
    add_header Access-Control-Allow-Headers 'X-Requested-With, Content-Type';
    add_header Access-Control-Allow-Credentials true;

  }
}
